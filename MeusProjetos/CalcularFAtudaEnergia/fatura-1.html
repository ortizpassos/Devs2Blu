<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Leitor de Fatura Celesc</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f8f9fa;
    }
    .result-table th {
      background-color: #0d6efd;
      color: white;
    }
    .spinner-border {
      width: 3rem;
      height: 3rem;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="card shadow">
      <div class="card-body">
        <h1 class="card-title text-primary mb-4">
          <i class="bi bi-receipt"></i> Leitor de Fatura Celesc
        </h1>

        <div class="mb-3">
          <label for="valorTotalFatura" class="form-label">Digite o valor total da fatura (R$):</label>
          <input type="number" class="form-control" id="valorTotalFatura" placeholder="Ex: 250.00" step="0.01" min="0" />
        </div>

        <div class="mb-3">
          <label for="totalKwhFaturado" class="form-label">Digite o total em Kwh faturado:</label>
          <input type="number" class="form-control" id="totalKwhFaturado" placeholder="Ex: 350" step="0.01" min="0" />
        </div>

        <div class="mb-3">
          <label for="karina" class="form-label">Digite a leitura de Karina:</label>
          <input type="number" class="form-control" id="karina" placeholder="Ex: 120.50" step="0.01" min="0" />
        </div>

        <div class="mb-3">
          <label for="david" class="form-label">Digite a leitura de David:</label>
          <input type="number" class="form-control" id="david" placeholder="Ex: 120.50" step="0.01" min="0" />
        </div>

        <button id="calcularBtn" class="btn btn-primary me-2">
          <i class="bi bi-calculator"></i> Calcular Consumo
        </button>
        <button id="resetBtn" class="btn btn-secondary me-2" style="display:none;">
          <i class="bi bi-arrow-clockwise"></i> Limpar
        </button>

        <div id="spinner" class="text-center mt-4" style="display: none;">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Calculando...</span>
          </div>
          <p class="mt-2">Calculando, aguarde...</p>
        </div>

        <div id="result" class="mt-4" style="display: none;"></div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const valorTotalFaturaInput = document.getElementById('valorTotalFatura');
    const totalKwhFaturadoInput = document.getElementById('totalKwhFaturado');
    const karinaInput = document.getElementById('karina');
    const davidInput = document.getElementById('david');
    const calcularBtn = document.getElementById('calcularBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resultDiv = document.getElementById('result');
    const spinner = document.getElementById('spinner');

    calcularBtn.addEventListener('click', () => {
      const valorTotalFatura = parseFloat(valorTotalFaturaInput.value);
      const totalKwhFaturado = parseFloat(totalKwhFaturadoInput.value);
      const karina = parseFloat(karinaInput.value);
      const david = parseFloat(davidInput.value);

      if (
        isNaN(valorTotalFatura) || valorTotalFatura <= 0 ||
        isNaN(totalKwhFaturado) || totalKwhFaturado <= 0 ||
        isNaN(karina) || karina < 0 ||
        isNaN(david) || david < 0
      ) {
        alert('Por favor, preencha todos os campos corretamente com valores positivos.');
        return;
      }

      spinner.style.display = "block";
      resultDiv.style.display = "none";

      setTimeout(() => {
        spinner.style.display = "none";

        const precoKwh = valorTotalFatura / totalKwhFaturado;
        const karinaKw = 200 - karina;
        const davidKw = 200 - david;

        if (karinaKw < 0 || davidKw < 0) {
          alert('As leituras de Karina e David devem ser menores ou iguais a 200.');
          return;
        }

        const totalKarina = karinaKw * precoKwh;
        const totalDavid = davidKw * precoKwh;

        const tatianaKw = totalKwhFaturado - karinaKw - davidKw;
        const totalTatiana = valorTotalFatura - (totalKarina + totalDavid);

        if (tatianaKw < 0 || totalTatiana < 0) {
          alert('A soma dos consumos ou valores de Karina e David excede o total da fatura.');
          return;
        }

        resultDiv.innerHTML = `
          <h4 class="text-success"><i class="bi bi-check-circle-fill"></i> Resultado</h4>
          <p><strong>Total a pagar da fatura:</strong> R$ ${valorTotalFatura.toFixed(2)}</p>
          <p><strong>Total kWh faturado:</strong> ${totalKwhFaturado.toFixed(2)} kWh</p>
          <p><strong>Preço médio por kWh:</strong> R$ ${precoKwh.toFixed(4)}</p>

          <table class="table table-bordered mt-3 result-table">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Consumo (kWh)</th>
                <th>Valor a pagar (R$)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><i class="bi bi-person-circle text-primary"></i> Karina</td>
                <td>${karinaKw.toFixed(2)}</td>
                <td>R$ ${totalKarina.toFixed(2)}</td>
              </tr>
              <tr>
                <td><i class="bi bi-person-circle text-primary"></i> David</td>
                <td>${davidKw.toFixed(2)}</td>
                <td>R$ ${totalDavid.toFixed(2)}</td>
              </tr>
              <tr>
                <td><i class="bi bi-person-circle text-primary"></i> Tatiana</td>
                <td>${tatianaKw.toFixed(2)}</td>
                <td>R$ ${totalTatiana.toFixed(2)}</td>
              </tr>
            </tbody>
          </table>
        `;

        resultDiv.style.display = "block";
        resetBtn.style.display = "inline-block";
      }, 500);
    });

    resetBtn.addEventListener('click', () => {
      valorTotalFaturaInput.value = '';
      totalKwhFaturadoInput.value = '';
      karinaInput.value = '';
      davidInput.value = '';
      resultDiv.innerHTML = '';
      resultDiv.style.display = 'none';
      spinner.style.display = 'none';
      resetBtn.style.display = 'none';
    });
  </script>
</body>
</html>
